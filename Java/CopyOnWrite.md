## 缘由
最近在看《Redis 设计与实现》，看到Redis的执行`bgsave`生成`dump.rdb`是根据`CopyOnWrite`的
之前也不是很懂为啥要有`CopyOnWrite`这个东西
翻看文章搞明白了

> 如果有多个调用者（callers）同时请求相同资源（如内存或磁盘上的数据存储），他们会共同**获取相同的指针指向相同的资源**，直到某个调用者**试图修改资源**的内容时，系统才会真正**复制一份专用副本**（private copy）给该调用者，而其他调用者所见到的最初的资源仍然保持不变。**优点**是如果调用者**没有修改该资源**，就**不会有副本**（private copy）被建立，因此多个调用者只是读取操作时可以**共享同一份资源**。

之前一直觉得CopyOnWrite很鸡肋.

----

现在解释一下：
`CopyOnWrite`就是不同的线程操作不同的资源，最后再整合，因此是**线程安全**的，但**不能保证强一致性**

比如我现在数据 1234 我要插入5

那么原来的线程看到的数据是 1234    我新开的线程看到的数据是 12345
并且`CopyOnWriteList`中的`set`和`add` 方法都是加锁了的，所以至多有一份拷贝。当这份拷贝资源执行完后，才会释放锁，进行下次的`set`或`add`方法

## 参考博客
[CopyOnWriteArrayList](https://yq.aliyun.com/articles/665359)